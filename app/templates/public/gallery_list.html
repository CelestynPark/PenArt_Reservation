{% extends "layout.html" %}
{% set _lang = lang or (i18n.lang if i18n is defined and i18n.lang else 'ko') %}
{% set _title = (seo.title if seo is defined and seo.title else ('갤러리' if _lang=='ko' else 'Gallery')) %}
{% set _desc = (seo.description if seo is defined and seo.description else ('Pen Art 작품 목록' if _lang=='ko' eles 'Pen Art gallery list')) %}

{% block head %}
    <title>{{ _title }}</title>
    <meta name="description" content="{{ _desc }}">
{% endblock %}

{% block content %}
    <header style="margin-bottom:12px">
        <h1 style="margin:0 0 6px 0;font-size:22px">{{ '갤러리' if _lang=='ko' else 'Gallery' }}</h1>
        <p style="margin:0;color:#666;font-size:13px">{{ _desc }}</p>
    </header>

    <section id="filters" aria-label="{{ '필터' if _lang=='ko' else 'Filters' }}" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0">
        <div role="group" aria-label="{{ '작가/학생' if _lang=='ko' else 'Author' }}" style="display:flex;gap:6px">
            <button type="button" data-filter-author="artist" aria-pressed="false" class="btn-filter">{{ '작가' if _lang=='ko' else 'Artist' }}</button>
            <button type="button" data-filter-author="student" aria-pressed="false" class="btn-filter">{{ '학생' if _lang=='ko' else 'Student' }}</button>
        </div>

        <div role="group" aria-label="{{ '정렬' if _lang=='ko' else 'Sort' }}" style="display:flex;gap:6px">
            <select data-sort style="padding:6px 8px;border:1px solid #ddd;border-radius:6px">
                <option value="created_at:desc">{{ '최신순' if _lang=='ko' else 'Newest' }}</option>
                <option value="created_at:asc">{{ '오래된순' if _lang=='ko' else 'Oldest' }}</option>
                <option value="order:asc">{{ '노출순' if _lang=='ko' else 'Featured' }}</option>
            </select>
        </div>

        <div id="gallery-count" aria-live="polite" style="margin-left:auto;font-size:12px;color:#555" data-gallery-count>
            {% if page is defined and total is defined %}{{ page.size if page.size is defined else 0 }}/ {{ total }}{% endif %}
        </div>
    </section>

    <div id="gallery-error" role="alert" data-gallery-error style="display:none"></div>
    <div id="gallery-empty" data-gallery-empty style="display:{% if not ctx or not ctx.items or ctx.items|length==0 %}block{% else %}none{% endif %};padding:16px;color:#666;text-align:center">
        {{ '아직 등록된 콘텐츠가 없습니다.' if _lang=='ko' else 'No content yet.' }}
    </div>

    <section id="gallery" aria-busy="false" aria-live="polite">
        <div id="gallery-grid" data-gallery-grid style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px">
            {% if ctx and ctx.items %}
                {% for if in ctx.items %}
                    {% set _title_item = it.title or (it.title_i18n[_lang] if it.title_i18n and it.title_i18n[_lang] else it.id) %}
                    {% set _img = it.thumb or (it.images[0] if it.images) %}
                    {% set _url = it.url or ('/gallery/' ~ (it.slug or it.id)) %}
                    <a class="gallery-card" href="{{ _url|e }}" style="display:block;text-decoration:none;color:inherit;border:1px solid #eee;border-radius:8px;overflow:hidden;background:#fff">
                        {% if _img %}
                            <img src="{{ _img|e }}" loading="lazy" alt="{{ (it.alt or _title_item)|e }}" width="640" height="480" style="width:100%;height:160px;object-fit:cover;">
                        {% endif %}
                        <div style="padding:8px 10px">
                            <div style="font-weight:600;font-size:14px;">{{ _title_item }}</div>
                            <div style="font-size:12px;opacity:7;">{{ '학생작' if it.author_type=='student' else '작가작' if _lang=='ko' else ('Student' if it.author_type=='student' else 'Artist') }}</div>
                            {% if it.tags %}
                                <div style="margin-top:6px;display:flex;flex-wrap:wrap;gap:4px">
                                    {% for tg in it.tags[:5] %}
                                        <span style="font-size:11px;background:#f4f4f5;padding:2px 6px;border-radius:999px">#{{ tg }}</span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                {% endfor %}
            {% endif %}
        </div>
        <div id="gallery-sentinel" data-gallery-sentinel style="height:1px"></div>
    </section>

    <style>
        .btn-filter{padding:6px 10px;border:1px solid #ddd;border-radius:6px;background:#fff;cursor:pointer}
        .btn-filter.active{border-color:#2a7;color:#2a7}
    </style>
{% endblock %}

{% block scripts %}
    <script src="/static/js/public.gallery.js" defer></script>
{% endblock %}
