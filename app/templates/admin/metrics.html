{% extends "admin/layout.html" %}
{% set active_id = 'metrics' %}
{% set _lang = (lang or (i18n.lang if i18n is defined and i18n.lang else 'ko')) %}
{% set _title = 'Admin · Metrics' %}

{% block content %}
<section aria-labelledby="metrics-title" data-page="metrics">
    <h1 id="metrics-title" style="margin:0 0 14px 0;font-size:20px;">{{ '지표' if _lang=='ko' else 'Metrics' }}</h1>

    <form id="metricsFilters" style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;margin-bottom:12px;">
        <label>
            <div>{{ '시작일(UTC)' if _lang=='ko' else 'From (UTC)' }}</div>
            <input type="date" name="date_from" required>
        </label>
        <label>
            <div>{{ '종료일(UTC)' if _lang=='ko' else 'To (UTC)' }}</div>
            <input type="date" name="date_to" required>
        </label>
        <label>
            <div>{{ '집계' if _lang=='ko' else 'Grouping' }}</div>
            <select name="type">
                <option value="daily">{{ '일간' if _lang=='ko' else 'Daily' }}</option>
                <option value="weekly">{{ '주간' if _lang=='ko' else 'Weekly' }}</option>
                <option value="monthly">{{ '월간' if _lang=='ko' else 'Monthly' }}</option>
            </select>
        </label>
        <button type="submit" class="btn" id="btnApply">{{ '적용' if _lang=='ko' else 'Apply' }}</button>
        <button type="button" class="btn" id="btnCsv">{{ '내보내기' if _lang=='ko' else 'Export CSV' }}</button>
    </form>

    <div id="metricsEmpty" class="alert" style="display:none;">{{ '데이터가 없습니다.' if _lang=='ko' else 'No data.' }}</div>

    <div id="metricsCards" style="display:flex;gap:10px;flex-wrap:wrap;margin:10px 0;">
        <div class="badge" id="sumBookings">bookings: 0</div>
        <div class="badge" id="sumOrders">orders: 0</div>
        <div class="badge" id="sumReviews">reviews: 0</div>
        <div class="badge" id="sumViews">views: 0</div>
    </div>

    <div id="chartWrap" style="border:1px solid var(--border);border-radius:10px;padding:10px;overflow:auto;">
        <svg id="metricsChart" width="100%" height="360" role="img" aria-label="Metrics chart"></svg>
    </div>
</section>
{% endblock %}

{% block scripts %}
    <script src="/static/js/admin/setting_metrics.js" defer {{ 'nonce=' ~ _csp_nonce if _csp_nonce }}></script>
{% endblock %}

